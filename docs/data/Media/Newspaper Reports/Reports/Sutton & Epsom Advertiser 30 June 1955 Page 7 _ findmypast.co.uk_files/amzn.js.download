/* Use of this pixel is subject to the Amazon ad specs and policies at http://www.amazon.com/b/?&node=7253015011. Version number: 5, Changeset: Adding in phone number support for setUserData */
this.amzn=this.amzn||{},this.amzn.js=function(){"use strict";const e=1e3,t=864e5;var n={NAME_MAX_LENGTH:256,EVENT_PARAMETER_MAX_VALUE_LENGTH:1e3,EVENT_NAME_EXCEEDED_MAX_LENGTH_WARNING:"Length of event's name is longer than 256 characters.",EVENT_PARAMETER_NAME_EXCEEDED_MAX_LENGTH_WARNING:"Length of event's parameter name exceeds 256 characters.",EVENT_PARAMETER_VALUE_EXCEEDED_MAX_LENGTH_WARNING:"Length of event's parameter value exceeds 1000 characters.",EVENT_PARAMETER_KEY_EXCEEDED_MAX_LENGTH_WARNING:"Length of event's parameter key exceeds 256 characters.",AMZN_TOKEN_COOKIE_NAME:"aatToken",AMZN_TOKEN_URL_QUERY_PARAM_NAME:"amznToken",NO_CONSENT_COOKIE_NAME:"AMZN-NoCookieConsent",MT_LP_QUERY_PARAM:"aref",MTS_EVENT_ATTRIBUTE:"arefs",MEASUREMENT_TOKEN_COOKIE_NAME:"amznAref",MS_IN_SEC:e,MS_IN_HOUR:36e5,MS_IN_DAY:t,MEASUREMENT_TOKEN_TTL_IN_MS:2592e6,NUM_MAX_MEASUREMENT_TOKENS:147,MEASUREMENT_TOKEN_TIMESTAMP_PAIR_DELIMITER:"|",MEASUREMENT_TIMESTAMP_SEPARATOR:".",MT_TS_PAIR_TS_INDEX:1,NEWEST_MEASUREMENT_TOKEN_INDEX:0,ARBITRARY_PAST_UNIX_TIMESTAMP:1,AMAZON_CONSENT_AIPES_ENABLED:!1,AIPES_AMAZON_CONSENT_STRING_FIELD_NAME:"amazonConsentString",AIPES_AMAZON_CONSENT_GEO_FIELD_NAME:"geo",AIPES_AMAZON_CONSENT_CONSENT_FIELD_NAME:"consent",AIPES_AMAZON_CONSENT_AMAZON_CONSENT_FIELD_NAME:"amazonConsentFormat",AIPES_AMAZON_CONSENT_AD_STORAGE_FIELD_NAME:"amzn_ad_storage",AIPES_AMAZON_CONSENT_USER_DATA_FIELD_NAME:"amzn_user_data",AIPES_AMAZON_CONSENT_TCF_FIELD_NAME:"tcf",AIPES_AMAZON_CONSENT_GPP_FIELD_NAME:"gpp",AIPES_AMAZON_CONSENT_COUNTRY_CODE_FIELD_NAME:"countryCode",AIPES_AMAZON_CONSENT_IP_ADDRESS_FIELD_NAME:"ipAddress"};const o=n,r=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;var a={isEmpty:function(e){return null==e||""===e||0===Object.keys(e).length||0===e.length},isValidAdTag:function(e){return e&&r.test(e)},measurementTokenTimestampPairsNestedArrToMeasurementTokenCookie:function(e){return e.map((e=>e.join(o.MEASUREMENT_TIMESTAMP_SEPARATOR))).join(o.MEASUREMENT_TOKEN_TIMESTAMP_PAIR_DELIMITER)},measurementTokenCookieToMeasurementTokenTimestampPairsNestedArr:function(e){return e?e.split(o.MEASUREMENT_TOKEN_TIMESTAMP_PAIR_DELIMITER).map((e=>{const[t,n]=e.split(o.MEASUREMENT_TIMESTAMP_SEPARATOR);return[t,Number(n)]})):[]}};const s=n;function i(){}i.prototype.isCookiePresent=function(e){return document.cookie.split(";").some((t=>t.trim().startsWith(`${e}=`)))},i.prototype.getCookieValue=function(e){return document.cookie.split(";").find((t=>t.trim().startsWith(`${e}=`)))?.split("=")[1]},i.prototype.writeCookie=function(e,t,n){const o=new Date(n).toUTCString();document.cookie=`${e}=${t}; expires=${o}; SameSite=Strict; secure=true;`},i.prototype.deleteCookie=function(e){this.writeCookie(e,"0",s.ARBITRARY_PAST_UNIX_TIMESTAMP)};var c=i;const E=n,_=c,{isEmpty:A,isValidAdTag:u}=a,d=["gdpr","gdpr_pd","gdpr_consent"];function N(e,t,n){e.searchParams.set(t,n);const o=Array.from(e.searchParams.entries());e.search="",o.forEach((n=>{n[0]!==t&&e.searchParams.set(n[0],n[1])})),e.search+=`&${t}=${n}`}var T={createQueryParams:function(e,{tagId:t,eventName:n,eventAttributes:o,consent:r,uuid:a}){const s="string"==typeof e?new URL(e):e;if(A(t))throw Error("Tag ID is a required parameter.");if(!u(t))throw Error("Invalid ad tag provided.");if(s.searchParams.set("pid",t),A(n))throw Error("Event name is a required parameter.");if(s.searchParams.set("event",n),Array.isArray(o)&&N(s,"items",encodeURI(JSON.stringify(o))),o&&Object.entries(o).forEach((([e,t])=>{d.includes(e)||(t||""===t)&&("object"==typeof t?s.searchParams.set(e,JSON.stringify(t)):s.searchParams.set(e,t))})),r&&d.forEach((e=>{r[e]&&s.searchParams.set(e,r[e])})),_.prototype.isCookiePresent.call({},E.AMZN_TOKEN_COOKIE_NAME)){const e=_.prototype.getCookieValue.call({},E.AMZN_TOKEN_COOKIE_NAME);e&&N(s,E.AMZN_TOKEN_URL_QUERY_PARAM_NAME,e)}const i=_.prototype.getCookieValue.call({},E.MEASUREMENT_TOKEN_COOKIE_NAME);return i&&N(s,E.MTS_EVENT_ATTRIBUTE,i),a&&s.searchParams.set("uuid",a),s}};const{createQueryParams:h}=T,p={"Google Chrome":106,Chromium:106},l="paa-reporting-advertising.amazon";function m(e){const t="/assets/conversion_module.js";switch(e.toLowerCase()){case"beta":case"test":return`https://beta-ara.${l}${t}`;case"gamma":return`https://gamma-ara.${l}${t}`;default:return`https://ara.${l}${t}`}}function f(){const{userAgentData:e}=navigator;return null!=e&&e.brands.some((({brand:e,version:t})=>p[e]<=t))}function M(){return document?.featurePolicy?.allowsFeature?.("attribution-reporting")&&document?.featurePolicy?.allowsFeature?.("private-aggregation")&&document?.featurePolicy?.allowsFeature?.("shared-storage")}async function g(e,t){try{const n=m(t);if(e&&n){const t=await e.json();if(!t||0===Object.keys(t).length||"healthy"===t)return Promise.resolve(!1);return(await(sharedStorage?.createWorklet(n,{dataOrigin:"script-origin"}))).run("conversion-module",{data:t,privateAggregationConfig:{contextId:t?.debugKey}})}}catch(e){}return Promise.resolve(!1)}var y={performTriggerRegistration:async function(e){const{stage:t}=e;if(!f())return Promise.resolve(!1);if(!M())return Promise.resolve(!1);const n=function(e){let t;switch(e.toLowerCase()){case"beta":case"test":t=`https://beta-ara.${l}/aat`;break;case"gamma":t=`https://gamma-ara.${l}/aat`;break;default:t=`https://ara.${l}/aat`}return new URL(t)}(t),o=h(n,e),r=await async function(e){const t={credentials:"same-origin",keepalive:!0,attributionReporting:{eventSourceEligible:!1,triggerEligible:!0}};let n;try{n=await(window?.fetch(e,t))}catch(e){}return n}(o.href);return g(r,t),r},generateUUID:function(){return f()&&M()&&"undefined"!=typeof crypto&&"function"==typeof crypto.randomUUID?crypto.randomUUID():""},generateWorkletUrl:m,runSharedStorageWorklet:g};const O=n,{isEmpty:C,isValidAdTag:I}=a,{createQueryParams:S}=T,{generateUUID:k}=y;function v(e){this.endpoints=e,this.region="NA",this.stage="PROD",this.tagIdsByLabels={},this.TCFv2={}}function P(e,t,n){const o=document.createElement("iframe");o.style.display="none",o.setAttribute("src",e),o.setAttribute("id",`tag_fire_${t}_${n}_${(new Date).getTime()}`),document.body.appendChild(o)}v.prototype.addTag=function({tagId:e,tagLabel:t}){if(C(e))return void console.warn("Tag id is required for addTag command");if(!I(e))return void console.warn(`Invalid tag id provided: ${e}`);const n=C(t)?e:t;this.tagIdsByLabels[n]=e},v.prototype.getTagIds=function(e){const{tagIdsByLabels:t}=this;return e.map((function(e){return t[e]||e}))},v.prototype.trackEvent=async function(e,t,n){return this.trackEventWithTags(e,t,n,Object.keys(this.tagIdsByLabels))},v.prototype.trackRequest=async function(e,t,n,o){const r=this.TCFv2[e],a=k();try{await async function({eventIngestionEndpoint:e,consent:t,eventAttributes:n,eventName:o,tagId:r,uuid:a}){const s=["gdpr","gdpr_pd","gdpr_consent"],i=[];if(o.length>O.NAME_MAX_LENGTH&&i.push(`${O.EVENT_NAME_EXCEEDED_MAX_LENGTH_WARNING}, ${o}`),Array.isArray(n)?n.forEach((function(e){Object.keys(e)[0].length>O.NAME_MAX_LENGTH&&i.push(`${O.EVENT_PARAMETER_NAME_EXCEEDED_MAX_LENGTH_WARNING}, ${Object.keys(e)[0]}`),e[Object.keys(e)[0]].length>O.EVENT_PARAMETER_MAX_VALUE_LENGTH&&i.push(`${O.EVENT_PARAMETER_VALUE_EXCEEDED_MAX_LENGTH_WARNING}, ${e[Object.keys(e)[0]]}`)})):n&&Object.keys(n).filter((function(e){return!s.includes(e)})).forEach((function(e){let t;e.length>O.NAME_MAX_LENGTH&&i.push(`${O.EVENT_PARAMETER_NAME_EXCEEDED_MAX_LENGTH_WARNING}, ${e}`),t=n[e],t||""===t?(t.length>O.EVENT_PARAMETER_MAX_VALUE_LENGTH?i.push(`${O.EVENT_PARAMETER_VALUE_EXCEEDED_MAX_LENGTH_WARNING}, ${t}`):Object.keys(t)&&Object.keys(t)[0]&&Object.keys(t).forEach((function(e){e.length>O.NAME_MAX_LENGTH&&i.push(`${O.EVENT_PARAMETER_KEY_EXCEEDED_MAX_LENGTH_WARNING}, ${e}`),t[e].length>O.EVENT_PARAMETER_MAX_VALUE_LENGTH&&i.push(`${O.EVENT_PARAMETER_VALUE_EXCEEDED_MAX_LENGTH_WARNING}, ${t[e]}`)})),"object"==typeof t&&(t=encodeURI(JSON.stringify(t)))):console.warn(`Key ${e} has no value`)})),i.length>0){const e=`Event has ${i.length} validation errors.`;return console.warn(e),console.warn(i),Promise.reject(e)}const c=S(new URL(e),{tagId:r,eventName:o,eventAttributes:n,consent:t,uuid:a}).href;if(!window.fetch||void 0===window.fetch)return P(c,r,o);try{const e=await fetch(c,{method:"get",credentials:"include",mode:"no-cors",keepalive:"true"});return Promise.resolve(e)}catch(e){return console.warn("Event request via fetch failed, reverting to iframe"),P(c,r,o)}}({eventIngestionEndpoint:t,consent:r,eventAttributes:o,eventName:n,tagId:e,uuid:a})}catch(e){return console.warn("Event request failed.",e),Promise.reject(e)}try{const{performTriggerRegistration:t}=y;await t({stage:this.stage,consent:this.TCFv2[e],tagId:e,eventName:n,eventAttributes:o,uuid:a})}catch(e){console.warn("ARA trigger registration failed",e)}return Promise.resolve()},v.prototype.trackEventWithTags=async function(e,t,n,o){const r=this.getPixelEndpoint(this.region),a=t||{},s="No eventName name specified.",i="No valid endpoint.";if(!e)return console.warn(s),Promise.reject(s);if(!r)return console.warn(i),Promise.reject(i);n&&(a.ts=n);const c=this.getTagIds(o).map((t=>this.trackRequest(t,r,e,a)));return Promise.all(c)},v.prototype.trackPixel=function(e,t,n){const o=this;let r;const a={};let s=t||"";s=s.split("?"),r=s.length>1?s[1]:s[0],r=r.split("&"),r.forEach((function(e){const t=e.split("=");let n,r;t.length<=1||("ex-fargs"===t[0]?(n=o.parsePixelArgs(t[1],"&"),a.fargs_id=n.id,a.fargs_type=n.type):"ex-hargs"===t[0]&&(r=o.parsePixelArgs(t[1],";"),a.hargs_c=r.c,a.hargs_p=r.p))})),this.validatePixelData(a),Object.keys(a).forEach((function(e){a[e]||delete a[e]})),this.trackEvent(e,a,n)},v.prototype.addTCFv2=function(e){this.addTCFv2WithTags(e,Object.keys(this.tagIdsByLabels))},v.prototype.addTCFv2WithTags=function(e,t){const{TCFv2:n}=this;this.getTagIds(t).forEach((function(t){n[t]=e}))},v.prototype.getPixelEndpoint=function(e){const t=this.endpoints[e.toUpperCase()];return""===t||null==t?(console.warn("Endpoint does not exist, please check your region configuration!"),null):t},v.prototype.parsePixelArgs=function(e,t){let n=decodeURIComponent(e);const o={};return n=n.replace(/\?/g,""),n.split(t).forEach((function(e){const t=e.split("=");if(t.length>1){const[e,n]=t;o[e]=n}})),o},v.prototype.validatePixelData=function(e){const t=e.hargs_c&&e.hargs_p,n=e.fargs_id&&e.fargs_type;t||n||console.warn("Invalid arguments for a trackPixel event, please check your implementation!")},v.prototype.setRegion=function(e){this.region=e},v.prototype.setStage=function(e){this.stage=e};var R=v;const w=n,{measurementTokenTimestampPairsNestedArrToMeasurementTokenCookie:D,measurementTokenCookieToMeasurementTokenTimestampPairsNestedArr:L}=a,U="AIPToken",b="cookieExpiry",z={method:"POST",mode:"cors",cache:"no-cache",credentials:"omit",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer-when-downgrade"};function K(e){this.cookieHandler=e,this.alreadySavedMeasurementToken=!1}K.prototype.saveMeasurementTokenInURLToCookieIfPresent=function(e){try{if("NA"!==e.toUpperCase()||this.alreadySavedMeasurementToken)return;const t=new URLSearchParams(window.location.search).get(w.MT_LP_QUERY_PARAM);if(!t)return;let n=this.cookieHandler.getCookieValue(w.MEASUREMENT_TOKEN_COOKIE_NAME);n?.split(w.MEASUREMENT_TOKEN_TIMESTAMP_PAIR_DELIMITER).length>=w.NUM_MAX_MEASUREMENT_TOKENS&&(n=D(L(n).slice(0,-1)));const o=Math.round(performance.timeOrigin),r=D([[t,o]].concat(L(n))),a=o+w.MEASUREMENT_TOKEN_TTL_IN_MS;this.cookieHandler.writeCookie(w.MEASUREMENT_TOKEN_COOKIE_NAME,r,a),this.alreadySavedMeasurementToken=!0}catch(e){}},K.prototype.removeAnyExpiredMeasurementTokens=function(){try{const e=this.cookieHandler.getCookieValue(w.MEASUREMENT_TOKEN_COOKIE_NAME);if(!e)return;const t=(new Date).getTime()-w.MEASUREMENT_TOKEN_TTL_IN_MS,n=L(e).filter((([,e])=>e>t));if(0===n.length)return void this.cookieHandler.deleteCookie(w.MEASUREMENT_TOKEN_COOKIE_NAME);const o=D(n),r=n[w.NEWEST_MEASUREMENT_TOKEN_INDEX][w.MT_TS_PAIR_TS_INDEX]+w.MEASUREMENT_TOKEN_TTL_IN_MS;this.cookieHandler.writeCookie(w.MEASUREMENT_TOKEN_COOKIE_NAME,o,r)}catch(e){}},K.prototype.formatRequestBody=function(e){const t={};if(null!==e.gdpr&&(t.gdpr=e.gdpr.enabled?1:0,null!==e.gdpr.consent&&(t.gdprConsent=e.gdpr.consent)),null===e.hashedRecords)throw Error("hashedRecords array is null");if(0===e.hashedRecords.length)throw Error("hashedRecords array is empty");return t.hashedRecords=e.hashedRecords,null!==e.ttl&&(t.ttl=e.ttl),void 0!==e.consentString&&(t[w.AIPES_AMAZON_CONSENT_STRING_FIELD_NAME]=e.consentString),t},K.prototype.requestAmznToken=async function(e){const t={...z,body:JSON.stringify(e)},n=await fetch("https://tk.amazon-adsystem.com/envelope",t);if(n.ok){return await n.json()}const o=await n.text();throw Error(o)},K.prototype.renewAmznToken=async function(e){if(!this.cookieHandler.isCookiePresent(w.AMZN_TOKEN_COOKIE_NAME)&&!this.cookieHandler.isCookiePresent(w.NO_CONSENT_COOKIE_NAME))try{const t=this.formatRequestBody(e),n=await this.requestAmznToken(t);return""===n[U]?this.cookieHandler.writeCookie(w.NO_CONSENT_COOKIE_NAME,n[U],n[b]):this.cookieHandler.writeCookie(w.AMZN_TOKEN_COOKIE_NAME,n[U],n[b]),n}catch(e){console.error(e)}return"no-op"},K.prototype.deleteAmznToken=async function(){this.cookieHandler.isCookiePresent(w.AMZN_TOKEN_COOKIE_NAME)&&this.cookieHandler.deleteCookie(w.AMZN_TOKEN_COOKIE_NAME),this.cookieHandler.isCookiePresent(w.NO_CONSENT_COOKIE_NAME)&&this.cookieHandler.deleteCookie(w.NO_CONSENT_COOKIE_NAME)},K.prototype.updateAmznToken=async function(e){return await this.deleteAmznToken(),this.renewAmznToken(e)};var H=K;const F=n;function G(e){this.tokensHandler=e,this.amazonConsent={}}async function X(e){const t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")}function $(e){return null!=e&&"string"==typeof e&&e.length>0}G.prototype.setUserData=async function(e){const t={gdpr:{enabled:!1,consent:""},hashedRecords:[],ttl:9600},n=e[1];n.gdpr&&(t.gdpr=n.gdpr),n.ttl&&(t.ttl=n.ttl);const o=/[A-Fa-f0-9]{64}/;if($(n.email)){const e={type:"email",record:""};n.email=n.email.trim().toLowerCase(),o.test(n.email)?e.record=n.email:e.record=await X(n.email),t.hashedRecords.push(e)}if($(n.phonenumber)){const e={type:"phonenumber",record:""};o.test(n.phonenumber)?e.record=n.phonenumber:e.record=await X(function(e){let t=e.replace(/[^\d+]+/g,"");return t=t.replace(/^00/,"+"),t.match(/^1/)&&(t=`+${t}`),t.match(/^\+/)||(t=`+1${t}`),t=t.replace(/^\+/,""),t}(n.phonenumber)),t.hashedRecords.push(e)}if(void 0!==this.amazonConsent&&(F.AMAZON_CONSENT_AIPES_ENABLED||this.amazonConsent.AMAZON_CONSENT_AIPES_ENABLED)){const e={},n={};void 0!==this.amazonConsent.geo&&(e[F.AIPES_AMAZON_CONSENT_GEO_FIELD_NAME]=function(e){const t={};void 0!==e.countryCode&&(t[F.AIPES_AMAZON_CONSENT_COUNTRY_CODE_FIELD_NAME]=e.countryCode);void 0!==e.ipAddress&&(t[F.AIPES_AMAZON_CONSENT_IP_ADDRESS_FIELD_NAME]=e.ipAddress);return t}(this.amazonConsent.geo)),void 0!==this.amazonConsent.amazonConsentFormat&&(n[F.AIPES_AMAZON_CONSENT_AMAZON_CONSENT_FIELD_NAME]=function(e){const t={};void 0!==e.amznAdStorage&&(t[F.AIPES_AMAZON_CONSENT_AD_STORAGE_FIELD_NAME]=e.amznAdStorage);void 0!==e.amznUserData&&(t[F.AIPES_AMAZON_CONSENT_USER_DATA_FIELD_NAME]=e.amznUserData);return t}(this.amazonConsent.amazonConsentFormat)),void 0!==this.amazonConsent.tcf&&(n[F.AIPES_AMAZON_CONSENT_TCF_FIELD_NAME]=this.amazonConsent.tcf),void 0!==this.amazonConsent.gpp&&(n[F.AIPES_AMAZON_CONSENT_GPP_FIELD_NAME]=this.amazonConsent.gpp),e[F.AIPES_AMAZON_CONSENT_CONSENT_FIELD_NAME]=n,t.consentString=e}return t.hashedRecords.length>0?this.tokensHandler.updateAmznToken(t):Promise.resolve()},G.prototype.setAmazonConsent=function(e){this.amazonConsent=e};var V,x,Z=G;function j(){if(x)return V;x=1;const e="amzn-ad-tag-",t=["AddToShoppingCart","Application","Checkout","Contact","Lead","Off-AmazonPurchases","Search","Signup","Subscribe"];function n(n){this.AD_TAG_HTML_PREFIX=e,this.AD_TAG_EVENT_NAMES=t,this.eventTracker=n}return n.prototype.init=function(){const{eventTracker:t}=this;this.AD_TAG_EVENT_NAMES.forEach((function(n){const o=e+n;document.getElementById(o)&&document.getElementById(o).addEventListener("click",(function(){t.trackEvent(n,{},(new Date).getTime())}))}))},n.prototype.addEventName=function(e){-1===t.indexOf(e)&&t.push(e)},n.prototype.overrideEventPrefix=function(e){this.AD_TAG_HTML_PREFIX=e},n.prototype.overrideEventName=function(e,n){const o=t.indexOf(e);-1!==o&&(t[o]=n)},V=n}function W(e,t,n,o){this.eventTracker=e,this.setUserDataHandler=t,this.tokensHandler=n,this.aatEventsQueue=[],this.isSetUserDataInProcess=!1,this.eventListener=o}j(),W.prototype.processCommandQueue=async function(e){const t=this,n=[];return(e||[]).forEach((function(e){n.push(t.processCommand(e[0],e[1]))})),Promise.all(n)},W.prototype.processCommand=async function(e,t=(new Date).getTime()){const n=Array.prototype.slice.call(e),o=e[0],r=`Unsupported tag command "${o}"`,a={trackevent:(e,t)=>this.trackEvent(e,t),trackpixel:(e,t)=>this.trackPixel(e,t),pixel:(e,t)=>this.withTag(e,t),withtag:(e,t)=>this.withTag(e,t),addpixel:e=>this.addTag(e),addtag:e=>this.addTag(e),addtcfv2:e=>this.addTCFv2(e),setregion:e=>this.setRegion(e),setstage:e=>this.setStage(e),setuserdata:e=>this.setUserData(e)};a.setamazonconsent=e=>this.setAmazonConsent(e);const s=o.toLowerCase();return a[s]?a[s](n,t):(console.warn(r),Promise.reject(r))},W.prototype.setUserData=async function(e){this.isSetUserDataInProcess=!0;try{await this.setUserDataHandler.setUserData(e),this.isSetUserDataInProcess=!1,this.processAatEventsQueue()}catch(e){return console.warn(e),Promise.reject(e)}return Promise.resolve()},W.prototype.processAatEventsQueue=function(){if(this.aatEventsQueue.length)for(;this.aatEventsQueue.length;){const{argumentArray:e,timestamp:t,tagLabel:n}=this.aatEventsQueue.pop();this.trackEvent(e,t,n).catch((e=>{console.warn(e)}))}},W.prototype.trackEvent=async function(e,t,n){if(this.isSetUserDataInProcess)return this.aatEventsQueue.unshift({argumentArray:e,timestamp:t,tagLabel:n}),Promise.resolve();this.tokensHandler.removeAnyExpiredMeasurementTokens();const o=e[1],r=e[2];return void 0!==n?this.eventTracker.trackEventWithTags(o,r,t,[n]):this.eventTracker.trackEvent(o,r,t)},W.prototype.trackPixel=function(e,t){this.eventTracker.trackPixel("__pixel__",e[1],t)},W.prototype.withTag=async function(e,t){const n=e[1],o=e[2]||"",r=`Unsupported command "${o}" used after "withTag" command`;switch(o.toUpperCase()){case"TRACKEVENT":return this.trackEvent(e.slice(2),t,n);case"ADDTCFV2":this.addTCFv2(e.slice(2),n);break;default:return console.warn(r),Promise.reject(r)}return Promise.resolve()},W.prototype.addTag=function(e){const t=e[2],n=e[1];this.eventTracker.addTag({tagId:n,tagLabel:t})},W.prototype.addTCFv2=function(e,t){const n=e[1];void 0!==t?this.eventTracker.addTCFv2WithTags(n,[t]):this.eventTracker.addTCFv2(n)},W.prototype.setRegion=function(e){const t=e[1].toUpperCase();this.eventTracker.setRegion(t),this.tokensHandler.saveMeasurementTokenInURLToCookieIfPresent(t)},W.prototype.setStage=function(e){const t=e[1].toUpperCase();this.eventTracker.setStage(t)},W.prototype.listen=function(){this.eventListener.init()},W.prototype.setAmazonConsent=function(e){this.setUserDataHandler.setAmazonConsent(e[1])};const B={NA:"https://s.amazon-adsystem.com/iu3",EU:"https://aax-eu.amazon-adsystem.com/s/iu3",FE:"https://aax-fe.amazon-adsystem.com/s/iu3"},Q=R,q=c,Y=H,J=Z,ee=W;return async function(){const e=new Q(B),t=new q,n=new Y(t),o=new J(n);let r=new ee(e,o,n);{const t=new(j())(e);r=new ee(e,o,n,t)}n.removeAnyExpiredMeasurementTokens(),window.amzn&&window.amzn.q&&r.processCommandQueue(window.amzn.q).catch((e=>{console.error("Error processing event queue",e)})),window.amzn=async function(...e){return r.processCommand(e).catch((e=>{console.error("Error processing command",e)}))},window.renewToken=async function(e){return n.renewAmznToken(e)},window.updateToken=async function(e){return n.updateAmznToken(e)},window.deleteToken=async function(){return n.deleteAmznToken()}}(),{}}();
